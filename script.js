/* ===================================
   TRANSLATIONS DATA
   =================================== */

const translations = {
    en: {
        nav: {
            home: "Home",
            about: "Why Choose Us",
            services: "Trips & Courses",
            booking: "Book Now"
        },
        hero: {
            subtitle: "Discover Scuba Diving in Hurghada",
            title1: "Enjoy Underwater",
            title2: "Experience",
            description: "Bluecharm diving center offers professional scuba diving and snorkeling services in Hurghada. Showcase trips and diving courses with easy booking.",
            viewCourses: "View Courses / Trips",
            bookNow: "Book Now"
        },
        about: {
            tagline: "Why Choose Us",
            title1: "Professional Scuba",
            title2: "Diving Services",
            description: "Located in Hurghada, Bluecharm diving center offers an unforgettable scuba diving and snorkeling experience in the Red Sea. Discover the beauty of marine life with our expert team.",
            features: [
                "Certified PADI Instructors",
                "Small Groups",
                "Best Dive Spots in Hurghada",
                "High-Quality Equipment",
                "Years of Experience"
            ],
            readMore: "Read More",
            yearsExperience: "Years of Experience"
        },
        services: {
            tagline: "Our Services",
            title: "Trips & Courses",
            tripsTitle: "Trips & Prices",
            coursesTitle: "Diving Courses",
            bookNow: "Book Now",
            trips: [
                { title: "Snorkeling", desc: "Two boat stops, snorkeling equipment, drinks and lunch included." },
                { title: "Introduction Dive", desc: "2 dives, diving equipment, diving instructor, drinks and lunch included." },
                { title: "Professional Divers", desc: "2 dives, tanks & weights, dive guide, drinks and lunch included." },
                { title: "Turtle Trip Marsa Alam", desc: "Two snorkeling/dives with turtles (transfer not included)." },
                { title: "Dolphin House", desc: "Two boat stops to swim with dolphins, snorkel equipment, drinks and lunch included." }
            ],
            courses: [
                { title: "Open Water Diver", desc: "Complete PADI Open Water certification." },
                { title: "PADI Advanced Open Water Diver", desc: "Advanced diving skills and specialties." },
                { title: "PADI Emergency First Response", desc: "Emergency response training." },
                { title: "PADI Rescue Diver", desc: "Rescue diving certification." },
                { title: "PADI Divemaster", desc: "Professional divemaster course." },
                { title: "PADI Enriched Air (Nitrox) Diver", desc: "Nitrox diving certification." },
                { title: "PADI Deep Diver", desc: "Deep diving specialization." },
                { title: "Bubblemaker Course", desc: "Introductory course for kids." }
            ]
        },
        booking: {
            title1: "Ready To",
            title2: "Book Now?",
            description: "Book your scuba diving trip or course in Hurghada. Our form sends a WhatsApp message directly to confirm your booking.",
            location: "Location",
            locationValue: "Hurghada, Egypt",
            contact: "Call / WhatsApp",
            formTitle: "Booking Form",
            name: "Name",
            phone: "Phone",
            whatsapp: "WhatsApp Number",
            email: "Email",
            date: "Date",
            program: "Select Program/Trip",
            message: "Message (optional)",
            submit: "Send WhatsApp Booking"
        },
        footer: {
            description: "Discover scuba diving and snorkeling in Hurghada with Bluecharm diving center. Professional underwater experiences.",
            contactTitle: "Contact Info",
            phone: "Phone",
            email: "Email",
            location: "Location",
            followUs: "Follow Us",
            copyright: "© 2025 Bluecharm in Hurghada. All Rights Reserved."
        },
        floating: {
            whatsapp: "Contact us on WhatsApp",
            email: "Send us an email"
        }
    },
    pl: {
        nav: {
            home: "Strona główna",
            about: "Dlaczego my",
            services: "Wycieczki i kursy",
            booking: "Zarezerwuj"
        },
        hero: {
            subtitle: "Odkryj nurkowanie w Hurghadzie",
            title1: "Ciesz się podwodnym",
            title2: "Doświadczeniem",
            description: "Profesjonalna firma nurkowa w Hurghadzie. Prezentujemy wycieczki i kursy nurkowania z łatwą rezerwacją.",
            viewCourses: "Zobacz kursy / wycieczki",
            bookNow: "Zarezerwuj teraz"
        },
        about: {
            tagline: "Dlaczego my",
            title1: "Profesjonalne usługi",
            title2: "Nurkowania",
            description: "Położony w Hurghadzie, Bluecharm oferuje niezapomniane podwodne doświadczenie na Morzu Czerwonym. Odkryj piękno życia morskiego z naszym zespołem ekspertów.",
            features: [
                "Certyfikowani instruktorzy PADI",
                "Małe grupy",
                "Najlepsze miejsca nurkowe w Hurghadzie",
                "Wysokiej jakości sprzęt",
                "Lata doświadczenia"
            ],
            readMore: "Czytaj więcej",
            yearsExperience: "Lat doświadczenia"
        },
        services: {
            tagline: "Nasze usługi",
            title: "Wycieczki i kursy",
            tripsTitle: "Wycieczki i ceny",
            coursesTitle: "Kursy nurkowania",
            bookNow: "Zarezerwuj",
            trips: [
                { title: "Snorkeling", desc: "Dwa przystanki łodzi, sprzęt do nurkowania z rurką, napoje i lunch wliczone." },
                { title: "Nurkowanie wprowadzające", desc: "2 nurkowania, sprzęt do nurkowania, instruktor nurkowania, napoje i lunch wliczone." },
                { title: "Nurkowie profesjonalni", desc: "2 nurkowania, butle i ciężarki, przewodnik nurkowy, napoje i lunch wliczone." },
                { title: "Wycieczka z żółwiami Marsa Alam", desc: "Dwa nurkowania/snorkeling z żółwiami (transfer nie wliczony)." },
                { title: "Dom delfinów", desc: "Dwa przystanki łodzi, aby pływać z delfinami, sprzęt do snorkelingu, napoje i lunch wliczone." }
            ],
            courses: [
                { title: "Nurek Open Water", desc: "Kompletny certyfikat PADI Open Water." },
                { title: "PADI Advanced Open Water Diver", desc: "Zaawansowane umiejętności i specjalizacje nurkowania." },
                { title: "PADI Emergency First Response", desc: "Szkolenie z reakcji ratunkowej." },
                { title: "PADI Rescue Diver", desc: "Certyfikacja nurkowania ratunkowego." },
                { title: "PADI Divemaster", desc: "Profesjonalny kurs divemaster." },
                { title: "PADI Enriched Air (Nitrox) Diver", desc: "Certyfikacja nurkowania Nitrox." },
                { title: "PADI Deep Diver", desc: "Specjalizacja nurkowania głębinowego." },
                { title: "Kurs Bubblemaker", desc: "Kurs wprowadzający dla dzieci." }
            ]
        },
        booking: {
            title1: "Gotowy do",
            title2: "Rezerwacji?",
            description: "Zarezerwuj wycieczkę nurkową lub kurs w Hurghadzie. Nasz formularz wysyła wiadomość WhatsApp bezpośrednio w celu potwierdzenia rezerwacji.",
            location: "Lokalizacja",
            locationValue: "Hurghada, Egipt",
            contact: "Telefon / WhatsApp",
            formTitle: "Formularz rezerwacji",
            name: "Imię",
            phone: "Telefon",
            whatsapp: "Numer WhatsApp",
            email: "E-mail",
            date: "Data",
            program: "Wybierz program/wycieczkę",
            message: "Wiadomość (opcjonalnie)",
            submit: "Wyślij rezerwację WhatsApp"
        },
        footer: {
            description: "Odkryj nurkowanie w Hurghadzie z Bluecharm. Profesjonalne podwodne doświadczenia.",
            contactTitle: "Informacje kontaktowe",
            phone: "Telefon",
            email: "E-mail",
            location: "Lokalizacja",
            followUs: "Śledź nas",
            copyright: "© 2025 Bluecharm w Hurghadzie. Wszelkie prawa zastrzeżone."
        },
        floating: {
            whatsapp: "Skontaktuj się z nami na WhatsApp",
            email: "Wyślij nam e-mail"
        }
    },
    ru: {
        nav: {
            home: "Главная",
            about: "Почему мы",
            services: "Туры и курсы",
            booking: "Забронировать"
        },
        hero: {
            subtitle: "Откройте для себя дайвинг в Хургаде",
            title1: "Наслаждайтесь подводным",
            title2: "Опытом",
            description: "Профессиональный дайвинг-бизнес в Хургаде. Демонстрируем туры и курсы дайвинга с легким бронированием.",
            viewCourses: "Просмотр курсов / туров",
            bookNow: "Забронировать сейчас"
        },
        about: {
            tagline: "Почему мы",
            title1: "Профессиональные услуги",
            title2: "Подводного плавания",
            description: "Расположенный в Хургаде, Bluecharm предлагает незабываемый подводный опыт в Красном море. Откройте для себя красоту морской жизни с нашей командой экспертов.",
            features: [
                "Сертифицированные инструкторы PADI",
                "Малые группы",
                "Лучшие места для дайвинга в Хургаде",
                "Высококачественное оборудование",
                "Годы опыта"
            ],
            readMore: "Читать далее",
            yearsExperience: "Лет опыта"
        },
        services: {
            tagline: "Наши услуги",
            title: "Туры и курсы",
            tripsTitle: "Туры и цены",
            coursesTitle: "Курсы дайвинга",
            bookNow: "Забронировать",
            trips: [
                { title: "Снорклинг", desc: "Две остановки лодки, снаряжение для снорклинга, напитки и обед включены." },
                { title: "Вводное погружение", desc: "2 погружения, снаряжение для дайвинга, инструктор по дайвингу, напитки и обед включены." },
                { title: "Профессиональные дайверы", desc: "2 погружения, баллоны и грузы, гид по дайвингу, напитки и обед включены." },
                { title: "Тур с черепахами Марса Алам", desc: "Два снорклинга/погружения с черепахами (трансфер не включен)." },
                { title: "Дом дельфинов", desc: "Две остановки лодки, чтобы поплавать с дельфинами, снаряжение для снорклинга, напитки и обед включены." }
            ],
            courses: [
                { title: "Дайвер Open Water", desc: "Полная сертификация PADI Open Water." },
                { title: "PADI Advanced Open Water Diver", desc: "Продвинутые навыки дайвинга и специализации." },
                { title: "PADI Emergency First Response", desc: "Обучение экстренной помощи." },
                { title: "PADI Rescue Diver", desc: "Сертификация спасательного дайвинга." },
                { title: "PADI Divemaster", desc: "Профессиональный курс дайвмастера." },
                { title: "PADI Enriched Air (Nitrox) Diver", desc: "Сертификация дайвинга на найтроксе." },
                { title: "PADI Deep Diver", desc: "Специализация глубоководного дайвинга." },
                { title: "Курс Bubblemaker", desc: "Вводный курс для детей." }
            ]
        },
        booking: {
            title1: "Готовы",
            title2: "Забронировать?",
            description: "Забронируйте тур или курс дайвинга в Хургаде. Наша форма отправляет сообщение WhatsApp напрямую для подтверждения бронирования.",
            location: "Местоположение",
            locationValue: "Хургада, Египет",
            contact: "Телефон / WhatsApp",
            formTitle: "Форма бронирования",
            name: "Имя",
            phone: "Телефон",
            whatsapp: "Номер WhatsApp",
            email: "Эл. почта",
            date: "Дата",
            program: "Выберите программу/тур",
            message: "Сообщение (необязательно)",
            submit: "Отправить бронирование WhatsApp"
        },
        footer: {
            description: "Откройте для себя дайвинг в Хургаде с Bluecharm. Профессиональный подводный опыт.",
            contactTitle: "Контактная информация",
            phone: "Телефон",
            email: "Эл. почта",
            location: "Местоположение",
            followUs: "Следите за нами",
            copyright: "© 2025 Bluecharm в Хургаде. Все права защищены."
        },
        floating: {
            whatsapp: "Свяжитесь с нами в WhatsApp",
            email: "Отправьте нам письмо"
        }
    },
    de: {
        nav: {
            home: "Startseite",
            about: "Warum wir",
            services: "Ausflüge & Kurse",
            booking: "Buchen"
        },
        hero: {
            subtitle: "Entdecke Tauchen in Hurghada",
            title1: "Genieße Unterwasser",
            title2: "Erlebnis",
            description: "Professionelles Tauchgeschäft in Hurghada. Präsentieren Sie Ausflüge und Tauchkurse mit einfacher Buchung.",
            viewCourses: "Kurse / Ausflüge ansehen",
            bookNow: "Jetzt buchen"
        },
        about: {
            tagline: "Warum wir",
            title1: "Professionelle Tauch",
            title2: "Dienstleistungen",
            description: "In Hurghada gelegen, bietet Bluecharm ein unvergessliches Unterwassererlebnis im Roten Meer. Entdecken Sie die Schönheit des Meereslebens mit unserem Expertenteam.",
            features: [
                "Zertifizierte PADI-Instruktoren",
                "Kleine Gruppen",
                "Beste Tauchplätze in Hurghada",
                "Hochwertige Ausrüstung",
                "Jahre der Erfahrung"
            ],
            readMore: "Mehr lesen",
            yearsExperience: "Jahre Erfahrung"
        },
        services: {
            tagline: "Unsere Dienstleistungen",
            title: "Ausflüge & Kurse",
            tripsTitle: "Ausflüge & Preise",
            coursesTitle: "Tauchkurse",
            bookNow: "Buchen",
            trips: [
                { title: "Schnorcheln", desc: "Zwei Bootsstopps, Schnorchelausrüstung, Getränke und Mittagessen inklusive." },
                { title: "Einführungstauchgang", desc: "2 Tauchgänge, Tauchausrüstung, Tauchlehrer, Getränke und Mittagessen inklusive." },
                { title: "Professionelle Taucher", desc: "2 Tauchgänge, Flaschen & Gewichte, Tauchführer, Getränke und Mittagessen inklusive." },
                { title: "Schildkröten-Ausflug Marsa Alam", desc: "Zwei Schnorchel-/Tauchgänge mit Schildkröten (Transfer nicht inklusive)." },
                { title: "Delfinhaus", desc: "Zwei Bootsstopps zum Schwimmen mit Delfinen, Schnorchelausrüstung, Getränke und Mittagessen inklusive." }
            ],
            courses: [
                { title: "Open Water Diver", desc: "Vollständige PADI Open Water Zertifizierung." },
                { title: "PADI Advanced Open Water Diver", desc: "Fortgeschrittene Tauchfähigkeiten und Spezialisierungen." },
                { title: "PADI Emergency First Response", desc: "Notfallhilfe-Training." },
                { title: "PADI Rescue Diver", desc: "Rettungstaucher-Zertifizierung." },
                { title: "PADI Divemaster", desc: "Professioneller Divemaster-Kurs." },
                { title: "PADI Enriched Air (Nitrox) Diver", desc: "Nitrox-Tauch-Zertifizierung." },
                { title: "PADI Deep Diver", desc: "Tieftauch-Spezialisierung." },
                { title: "Bubblemaker Kurs", desc: "Einführungskurs für Kinder." }
            ]
        },
        booking: {
            title1: "Bereit zu",
            title2: "Buchen?",
            description: "Buchen Sie Ihren Tauchausflug oder Kurs in Hurghada. Unser Formular sendet eine WhatsApp-Nachricht direkt zur Bestätigung Ihrer Buchung.",
            location: "Standort",
            locationValue: "Hurghada, Ägypten",
            contact: "Anruf / WhatsApp",
            formTitle: "Buchungsformular",
            name: "Name",
            phone: "Telefon",
            whatsapp: "WhatsApp-Nummer",
            email: "E-Mail",
            date: "Datum",
            program: "Programm/Ausflug auswählen",
            message: "Nachricht (optional)",
            submit: "WhatsApp-Buchung senden"
        },
        footer: {
            description: "Entdecken Sie Tauchen in Hurghada mit Bluecharm. Professionelle Unterwassererlebnisse.",
            contactTitle: "Kontaktinformationen",
            phone: "Telefon",
            email: "E-Mail",
            location: "Standort",
            followUs: "Folgen Sie uns",
            copyright: "© 2025 Bluecharm in Hurghada. Alle Rechte vorbehalten."
        },
        floating: {
            whatsapp: "Kontaktieren Sie uns auf WhatsApp",
            email: "Senden Sie uns eine E-Mail"
        }
    }
};

const LANGUAGES = [
    { code: 'en', name: 'English' },
    { code: 'pl', name: 'Polski' },
    { code: 'ru', name: 'Русский' },
    { code: 'de', name: 'Deutsch' }
];

/* ===================================
   GLOBAL STATE
   =================================== */

let currentLang = 'en';
let selectedProgram = '';

/* ===================================
   TRIPS & COURSES DATA
   =================================== */

const tripImages = [
    "https://images.unsplash.com/photo-1583364493238-248032147fbd?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8c25vcmtsaW5nfGVufDB8fDB8fHww",
    "https://images.unsplash.com/photo-1579052578742-99f61b8d7bd6?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1yZWxhdGVkfDF8fHxlbnwwfHx8fHw%3D",
    "https://plus.unsplash.com/premium_photo-1750263797033-77387f35cb2f?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1yZWxhdGVkfDIwfHx8ZW58MHx8fHx8",
    "https://images.unsplash.com/photo-1574244104030-7ebb728e683c?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
    "https://images.unsplash.com/photo-1651871979877-7afef92792c4?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
];

const courseImages = [
    "https://images.unsplash.com/photo-1682687982298-c7514a167088?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
    "https://images.unsplash.com/photo-1645453352382-4528c269cd5d?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
    "https://images.unsplash.com/photo-1682686581413-0a0ec9bb35bb?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
    "https://plus.unsplash.com/premium_photo-1661841439995-1706237c83dc?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
    "https://images.unsplash.com/photo-1758968428279-bc19772942b0?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
    "https://images.unsplash.com/photo-1512136146408-dab5f2ba8ebb?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
    "https://images.unsplash.com/photo-1583364493238-248032147fbd?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
    "https://images.unsplash.com/photo-1682687982470-8f1b0e79151a?fm=jpg&q=80&w=800&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
];

const tripsPrices = [
    { price: "€25" },
    { price: "€35" },
    { price: "€45" },
    { price: "€50" },
    { price: "€75" }
];

const coursesPrices = [
    { price: "€250" },
    { price: "€250" },
    { price: "€200" },
    { price: "€400" },
    { price: "€700" },
    { price: "€170" },
    { price: "€250" },
    { price: "€100" }
];

/* ===================================
   INITIALIZE ON PAGE LOAD
   =================================== */

document.addEventListener('DOMContentLoaded', function () {
    // Initialize Lucide icons
    lucide.createIcons();

    // Initialize components
    initNavbar();
    initMobileMenu();
    initLanguageSelector();
    initFloatingButtons();
    initScrollAnimations();
    initServices();
    initBookingForm();

    // Set initial language
    updateLanguage(currentLang);

    // Scroll to top on load to prevent automatic scrolling
    window.scrollTo(0, 0);
});

/* ===================================
   NAVBAR
   =================================== */

function initNavbar() {
    const navbar = document.getElementById('navbar');

    window.addEventListener('scroll', function () {
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });

    // Smooth scroll for nav links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth' });
                // Close mobile menu if open
                closeMobileMenu();
            }
        });
    });
}

/* ===================================
   MOBILE MENU
   =================================== */

function initMobileMenu() {
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

    mobileMenuToggle.addEventListener('click', function () {
        openMobileMenu();
    });

    mobileMenuClose.addEventListener('click', function () {
        closeMobileMenu();
    });

    mobileNavLinks.forEach(link => {
        link.addEventListener('click', function () {
            closeMobileMenu();
        });
    });

    function openMobileMenu() {
        mobileMenu.classList.add('open');
        document.body.style.overflow = 'hidden';
        menuIcon.style.display = 'none';
        closeIcon.style.display = 'block';
        lucide.createIcons();
    }

    function closeMobileMenu() {
        mobileMenu.classList.remove('open');
        document.body.style.overflow = 'auto';
        menuIcon.style.display = 'block';
        closeIcon.style.display = 'none';
        lucide.createIcons();
    }
}

function closeMobileMenu() {
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    mobileMenu.classList.remove('open');
    document.body.style.overflow = 'auto';
    menuIcon.style.display = 'block';
    closeIcon.style.display = 'none';
    lucide.createIcons();
}

/* ===================================
   LANGUAGE SELECTOR
   =================================== */

function initLanguageSelector() {
    // Desktop Language Selector
    const languageBtnDesktop = document.getElementById('language-btn-desktop');
    const languageMenuDesktop = document.getElementById('language-menu-desktop');
    const languageOptionsDesktop = languageMenuDesktop.querySelectorAll('.language-option');

    languageBtnDesktop.addEventListener('click', function (e) {
        e.stopPropagation();
        languageMenuDesktop.classList.toggle('show');
    });

    languageOptionsDesktop.forEach(option => {
        option.addEventListener('click', function () {
            const lang = this.getAttribute('data-lang');
            updateLanguage(lang);
            languageMenuDesktop.classList.remove('show');
        });
    });

    // Close menu when clicking outside
    document.addEventListener('click', function (e) {
        if (!languageBtnDesktop.contains(e.target) && !languageMenuDesktop.contains(e.target)) {
            languageMenuDesktop.classList.remove('show');
        }
    });

    // Mobile Language Selector
    const languageSelectMobile = document.getElementById('language-select-mobile');

    languageSelectMobile.addEventListener('change', function () {
        updateLanguage(this.value);
        closeMobileMenu();
    });
}

function updateLanguage(lang) {
    currentLang = lang;
    document.documentElement.lang = lang;
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

    // Update desktop language button
    const currentLanguageDesktop = document.getElementById('current-language-desktop');
    const selectedLang = LANGUAGES.find(l => l.code === lang);
    if (currentLanguageDesktop && selectedLang) {
        currentLanguageDesktop.textContent = selectedLang.name;
    }

    // Update mobile language select
    const languageSelectMobile = document.getElementById('language-select-mobile');
    if (languageSelectMobile) {
        languageSelectMobile.value = lang;
    }

    // Update all translated elements
    updateTranslations();

    // Update tooltips
    updateFloatingTooltips();

    // Regenerate services
    renderServices();
}

function updateTranslations() {
    const t = translations[currentLang];

    // Update all elements with data-translate attribute
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        const value = getNestedProperty(t, key);
        if (value) {
            element.textContent = value;
        }
    });

    // Update placeholders
    document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        const value = getNestedProperty(t, key);
        if (value) {
            element.placeholder = value;
        }
    });

    // Update select options
    const programSelect = document.getElementById('program');
    if (programSelect && programSelect.options[0]) {
        programSelect.options[0].text = t.booking.program;
    }
}

function getNestedProperty(obj, path) {
    return path.split('.').reduce((prev, curr) => {
        return prev ? prev[curr] : null;
    }, obj);
}

/* ===================================
   FLOATING CONTACT BUTTONS
   =================================== */

function initFloatingButtons() {
    updateFloatingTooltips();
}

function updateFloatingTooltips() {
    const t = translations[currentLang].floating;
    const whatsappTooltip = document.getElementById('whatsapp-tooltip');
    const emailTooltip = document.getElementById('email-tooltip');

    if (whatsappTooltip) whatsappTooltip.textContent = t.whatsapp;
    if (emailTooltip) emailTooltip.textContent = t.email;
}

function showTooltip(type) {
    const tooltip = document.getElementById(`${type}-tooltip`);
    if (tooltip) {
        tooltip.classList.add('show');
    }
}

function hideTooltip(type) {
    const tooltip = document.getElementById(`${type}-tooltip`);
    if (tooltip) {
        tooltip.classList.remove('show');
    }
}

// Make functions available globally for inline handlers
window.showTooltip = showTooltip;
window.hideTooltip = hideTooltip;

/* ===================================
   SCROLL ANIMATIONS
   =================================== */

function initScrollAnimations() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
            }
        });
    }, {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    });

    document.querySelectorAll('.fade-in-section').forEach(section => {
        observer.observe(section);
    });
}

/* ===================================
   SERVICES SECTION
   =================================== */

function initServices() {
    renderServices();
}

function renderServices() {
    const t = translations[currentLang].services;

    // Render Trips
    const tripsGrid = document.querySelector('.trips-grid');
    if (tripsGrid) {
        tripsGrid.innerHTML = '';
        t.trips.forEach((trip, idx) => {
            const card = createServiceCard(
                trip.title,
                trip.desc,
                tripsPrices[idx].price,
                tripImages[idx],
                `trip-${idx}`,
                trip.title + ' - ' + tripsPrices[idx].price
            );
            tripsGrid.appendChild(card);
        });
    }

    // Render Courses
    const coursesGrid = document.querySelector('.courses-grid');
    if (coursesGrid) {
        coursesGrid.innerHTML = '';
        t.courses.forEach((course, idx) => {
            const card = createServiceCard(
                course.title,
                course.desc,
                coursesPrices[idx].price,
                courseImages[idx],
                `course-${idx}`,
                course.title + ' - ' + coursesPrices[idx].price
            );
            coursesGrid.appendChild(card);
        });
    }
}

function createServiceCard(title, description, price, image, cardId, programValue) {
    const t = translations[currentLang].services;

    const card = document.createElement('div');
    card.className = 'service-card';
    card.id = cardId;

    card.innerHTML = `
        <img src="${image}" 
             alt="${title} - Scuba diving and snorkeling in Hurghada with Bluecharm diving center" 
             loading="lazy" 
             class="service-card-image">
        <div class="service-card-content">
            <div class="service-card-body">
                <h3 class="service-card-title">${title}</h3>
                <div class="service-card-price">${price}</div>
                <p class="service-card-description">${description}</p>
            </div>
            <a href="#booking" class="service-card-btn" data-program="${programValue}">
                ${t.bookNow}
            </a>
        </div>
    `;

    // Add click handler to the book button
    const bookBtn = card.querySelector('.service-card-btn');
    bookBtn.addEventListener('click', function (e) {
        e.preventDefault();
        handleBooking(programValue, cardId);
    });

    return card;
}

function handleBooking(programValue, cardId) {
    const card = document.getElementById(cardId);

    // Animate card
    if (card) {
        card.classList.add('animating');
        setTimeout(() => {
            card.classList.remove('animating');
        }, 500);
    }

    // Set program and show success
    setTimeout(() => {
        selectedProgram = programValue;
        const programSelect = document.getElementById('program');
        if (programSelect) {
            programSelect.value = programValue;

            // Highlight select
            programSelect.classList.add('highlight');
            setTimeout(() => {
                programSelect.classList.remove('highlight');
            }, 1000);
        }

        // Show success notification
        showSuccessNotification();

        // Scroll to booking
        document.getElementById('booking').scrollIntoView({ behavior: 'smooth' });
    }, 300);
}

function showSuccessNotification() {
    const notification = document.getElementById('success-notification');
    if (notification) {
        notification.classList.add('show');
        setTimeout(() => {
            notification.classList.remove('show');
        }, 1500);
    }
}

/* ===================================
   BOOKING FORM
   =================================== */

function initBookingForm() {
    const bookingForm = document.getElementById('booking-form');

    bookingForm.addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = new FormData(bookingForm);
        const name = formData.get('name');
        const phone = formData.get('phone');
        const whatsapp = formData.get('whatsapp');
        const email = formData.get('email');
        const date = formData.get('date');
        const program = formData.get('program');
        const message = formData.get('message');

        const whatsappMessage = `Hello, I want to book ${program} on ${date}. Name: ${name}, Phone: ${phone}, WhatsApp: ${whatsapp}, Email: ${email}, Message: ${message}`;

        const whatsappUrl = `https://wa.me/201065940203?text=${encodeURIComponent(whatsappMessage)}`;
        window.open(whatsappUrl, '_blank');
    });
}